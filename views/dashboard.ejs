<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Salesforce Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    body {
      background-color: #ebf5fd;
      font-family: sans-serif;
      font-size: 0.875rem;
      /* 14px */
      margin: 0;
      padding: 0;
    }

    a {
      text-decoration: none;
    }

    .container {
      width: 100%;
      /* max-width: 1200px; */
      margin: 0;
      padding: 0;
      /* padding: 20px; */
    }

    /* Header: Logo Left, Icons Right */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 25px;
      background-color: white;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .header img {
      height: 24px;
    }

    .header .icons svg {
      width: 20px;
      height: 20px;
      margin-left: 15px;
    }

    /* Navigation Tabs */
    .nav-tabs {
      display: flex;
      justify-content: start;
      padding: 10px 30px 0px;
      background-color: white;
      border-bottom: 2px solid #0070d2;
    }

    .nav-tabs svg {
      /* margin-right: 30px; */
      padding-top: 5px;
    }

    .nav-tabs a {
      text-decoration: none;
      color: #080707;
      margin-right: 30px;
      font-weight: 500;
      padding: 8px 0px;
    }

    .nav-tabs .active {
      background: #E8F3FD;
      box-shadow: 0px 3px 0px #1589EE inset;
      padding: 8px 12px;
    }

    .nav-tabs a:hover {
      color: #0056a2;
    }

    .nav-tabs a>svg {
      margin-left: 7px;
    }

    .section {
      padding: 15px;
      background-color: #F3F3F3;
      border-bottom: 1px solid #e2e8f0;
      /* box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); */
      margin: 20px 15px 0px;
    }

    /* Section: Opportunities Header and Actions */
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      width: 100%;
    }

    .section-header .left {
      display: flex;
      align-items: center;
    }

    .section-header .left svg {
      margin-right: 8px;
    }

    .section-header .left2 {
      display: flex;
      flex-direction: column;
    }

    .section-header .left2 svg {
      margin-left: 18px;
    }

    .section-header .left .title {
      font-size: 1.125rem;
      font-weight: 700;
    }

    .section-header .left .subtitle {
      font-size: 0.875rem;
      font-weight: 500;
      color: #4a5568;
    }

    .section-header .right button {
      padding: 8px 12px;
      background-color: white;
      border: 1px solid #e2e8f0;
      color: #0070D2;
      border-radius: 4px;
      cursor: pointer;
      margin-left: -4px;
    }

    .section-header .button:hover {
      background-color: #f7fafc;
    }

    .search-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 7px;
    }

    .search-info .left {
      font-size: 0.875rem;
      color: #4a5568;
    }

    .search-info .right input {
      padding: 8px 12px;
      font-size: 0.875rem;
      border-radius: 4px;
      border: 1px solid #DDDBDA;
      width: 250px;
      border-radius: 4px;
      margin: 0px;
    }

    .search-info .right .icons-filter {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .search-info .right .icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      margin-left: 15px;
      background-color: #fff;
      border: #DDDBDA 1px solid;
      border-radius: 4px;
    }

    .search-info .right .icon svg {
      width: 20px;
      height: 20px;
    }

    /* Table */
    .table-container {
      overflow-y: auto;
      padding: 15px;
      margin-top: -15px;
      max-height: 80vh;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
      /* border: 1px solid #e2e8f0; */
    }

    th {
      padding: 12px;
      text-align: left;
      border-right: 1px solid #e2e8f0;
      border-bottom: 1px solid #e2e8f0;
    }

    td {
      padding: 10px;
      border-bottom: 1px solid #e2e8f0;
      text-align: left;
    }

    th {
      background-color: #f7fafc;
      color: #4a5568;
    }

    th:nth-child(n+3) {
      position: relative;
      text-align: left;
      /* keep text aligned left */
      padding-right: 30px;
      /* space for svg on the right */
    }

    th:nth-child(n+3) svg {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
      /* optional: prevents interaction */
    }

    tr:hover {
      background-color: #f9fafb;
    }

    .text-blue {
      color: #014486;
    }

    .underline {
      text-decoration: underline;
    }


    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.4);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-content {
      background: white;
      width: fit-content;
      max-width: 65%;
      min-width: 33%;
      border-radius: 0.25rem;
      font-family: Arial, sans-serif;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      padding: 5px 15px;
      overflow-y: auto;
      max-height: 90vh;
    }

    .form-title {
      font-size: 20px;
      text-align: center;
      font-weight: 600;
      margin-top: 10px;
    }

    .form-underline {
      margin: 8px auto;
      border: none;
      border-top: 1px solid #ddd;
      width: 100%;
    }

    .required-note {
      font-size: 13px;
      text-align: right;
      color: #333;
      margin-right: 20px;
    }

    .required-star {
      color: red;
      margin-right: 2px;
    }

    .section-heading {
      background: #f3f3f3;
      padding: 10px;
      font-weight: bold;
      border-radius: 4px;
      margin: 15px 0;
    }

    .owner-display {
      display: flex;
      align-items: center;
      gap: 5px;
      font-weight: 500;
      margin-bottom: 10px;
      color: #0070d2;
    }

    input[type="text"],
    input[type="email"],
    input[type="date"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: 8px;
      margin: 5px 0 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    .row {
      display: flex;
      gap: 20px;
      align-items: center;
      justify-content: center;
    }

    .half {
      width: 100%;
    }

    .form-actions {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
      padding-bottom: 20px;
    }

    .btn {
      padding: 8px 20px;
      border: none;
      border-radius: 4px;
      font-weight: 500;
      cursor: pointer;
    }

    .btn.cancel {
      background: #fff;
      border: 1px solid #ccc;
    }

    .btn.secondary {
      background: #e0e0e0;
    }

    .btn.primary {
      background: #0070d2 !important;
      color: white !important;
    }

    /* Form rows */
    .form-row {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }

    .form-row input {
      flex: 1;
    }

    /* Actions */
    .form-actions {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }

    .form-actions button {
      padding: 8px 16px;
      font-size: 14px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .form-actions button[type="button"] {
      background-color: #f4f6f9;
      color: #333;
    }

    .form-actions button[type="submit"] {
      background-color: white;
      color: #0070d2;
      border: 1px solid #ccc;
    }

    .form-actions button:hover {
      opacity: 0.9;
    }

    label {
      display: block;
      font-size: 14px;
      margin-bottom: 4px;
      white-space: nowrap;
      /* Prevent line break */
    }

    #end_date_display,
    #end_date_displayy {
      font-size: 12px;
      /* color: #e04e39; */
      display: block;
      margin-top: -10px;
    }

    .result {
      width: 250px;
    }

    textarea[name="note"],
    textarea[name='billing_address'] {
      width: 100%;
      height: 100px;
      resize: vertical;
      margin-top: 10px;
    }

    #closedWonFields {
      background: #fff;
      padding: 15px 0;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
      color: #111827;
    }

    /* input[type="text"] {
  width: 100%;
  padding: 10px 14px;
  border: 1px solid #D1D5DB;
  border-radius: 6px;
  font-size: 14px;
  background-color: #fff;
} */

    .upload-box {
      border: 1px solid #3B82F6;
      padding: 12px 20px;
      align-items: center;
      gap: 8px;
      color: #1D4ED8;
      font-weight: 500;
      font-size: 14px;
      cursor: pointer;
      width: 35%;
    }

    .upload-box:hover {
      background-color: #E0E7FF;
    }

    .upload-icon {
      width: 20px;
      height: 20px;
    }

    .uploaded-file {
      display: flex;
      align-items: center;
      margin-top: 12px;
      color: #374151;
      font-size: 14px;
      gap: 6px;
    }

    .file-icon {
      width: 18px;
      height: 18px;
    }

    .hint-text {
      color: #6B7280;
      font-size: 12px;
      margin-top: 6px;
    }
  </style>


</head>

<body>

  <div class="container">
    <!-- Header: Logo Left, Icons Right -->
    <div class="header">
      <img src="https://res.cloudinary.com/dqfnwh89v/image/upload/v1724401978/Aek_Ads_Logo_ltfni2.svg" alt="Logo" />
      <div class="icons">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M21.2296 15.238H20.9988C20.1219 15.238 19.3834 14.4996 19.3834 13.6226V8.31495C19.3834 4.11495 15.8757 0.745722 11.6296 0.930337C7.66034 1.11495 4.61418 4.53034 4.61418 8.54572V13.6688C4.61418 14.5457 3.87572 15.238 2.9988 15.238H2.76803C1.75264 15.238 0.921875 16.115 0.921875 17.1303V17.8226C0.921875 18.1457 1.24495 18.4688 1.61418 18.4688H22.3834C22.7526 18.4688 23.0757 18.1457 23.0757 17.7765V17.0842C23.0757 16.0688 22.245 15.238 21.2296 15.238ZM14.2603 20.315H9.73726C9.46034 20.315 9.22957 20.5919 9.27572 20.8688C9.50649 22.1611 10.6603 23.0842 11.9988 23.0842C13.3373 23.0842 14.4911 22.115 14.7219 20.8688C14.768 20.5919 14.5373 20.315 14.2603 20.315Z"
            fill="#ABABAB" />
        </svg>

        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="32" height="32" rx="16" fill="#34BECD" />
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M23.3864 21.2309V21.9078C23.3864 22.7078 22.7095 23.3847 21.9095 23.3847H10.0941C9.29411 23.3847 8.61719 22.7078 8.61719 21.9078V21.2309C8.61719 19.4462 10.7095 18.3386 12.6787 17.477L12.8633 17.3847C13.0172 17.3232 13.171 17.3232 13.3249 17.4155C14.1249 17.9386 15.0172 18.2155 15.971 18.2155C16.9249 18.2155 17.848 17.9078 18.6172 17.4155C18.771 17.3232 18.9249 17.3232 19.0787 17.3847L19.2633 17.477C21.2941 18.3386 23.3864 19.4155 23.3864 21.2309ZM16.0018 8.61548C18.0326 8.61548 19.6633 10.4309 19.6633 12.677C19.6633 14.9232 18.0326 16.7386 16.0018 16.7386C13.971 16.7386 12.3403 14.9232 12.3403 12.677C12.3403 10.4309 13.971 8.61548 16.0018 8.61548Z"
            fill="white" />
        </svg>

      </div>
    </div>

    
      <!-- Navigation Tabs -->
      <div class="nav-tabs">
        <svg width="20" height="21" viewBox="0 0 20 21" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M2.44238 15.6152C3.79098 15.6154 4.88465 16.709 4.88477 18.0576C4.88477 19.4063 3.79105 20.4999 2.44238 20.5C1.09361 20.5 0 19.4064 0 18.0576C0.000117634 16.7089 1.09368 15.6152 2.44238 15.6152ZM10 15.6152C11.3487 15.6152 12.4423 16.7089 12.4424 18.0576C12.4424 19.4064 11.3488 20.5 10 20.5C8.65123 20.5 7.55762 19.4064 7.55762 18.0576C7.55773 16.7089 8.6513 15.6152 10 15.6152ZM17.5576 15.6152C18.9063 15.6152 19.9999 16.7089 20 18.0576C20 19.4064 18.9064 20.5 17.5576 20.5C16.2089 20.4999 15.1152 19.4063 15.1152 18.0576C15.1154 16.709 16.209 15.6154 17.5576 15.6152ZM2.44238 8.05762C3.79105 8.05773 4.88477 9.1513 4.88477 10.5C4.88477 11.8487 3.79105 12.9423 2.44238 12.9424C1.09361 12.9424 0 11.8488 0 10.5C1.28853e-07 9.15123 1.09361 8.05762 2.44238 8.05762ZM10 8.05762C11.3488 8.05762 12.4424 9.15123 12.4424 10.5C12.4424 11.8488 11.3488 12.9424 10 12.9424C8.65123 12.9424 7.55762 11.8488 7.55762 10.5C7.55762 9.15123 8.65123 8.05762 10 8.05762ZM17.5576 8.05762C18.9064 8.05762 20 9.15123 20 10.5C20 11.8488 18.9064 12.9424 17.5576 12.9424C16.2089 12.9423 15.1152 11.8487 15.1152 10.5C15.1152 9.1513 16.2089 8.05773 17.5576 8.05762ZM2.44238 0.5C3.79105 0.500117 4.88477 1.59368 4.88477 2.94238C4.88465 4.29098 3.79098 5.38465 2.44238 5.38477C1.09368 5.38477 0.000117376 4.29105 0 2.94238C0 1.59361 1.09361 0.5 2.44238 0.5ZM10 0.5C11.3488 0.5 12.4424 1.59361 12.4424 2.94238C12.4423 4.29105 11.3487 5.38477 10 5.38477C8.6513 5.38477 7.55773 4.29105 7.55762 2.94238C7.55762 1.59361 8.65123 0.5 10 0.5ZM17.5576 0.5C18.9064 0.5 20 1.59361 20 2.94238C19.9999 4.29105 18.9063 5.38477 17.5576 5.38477C16.209 5.38465 15.1154 4.29098 15.1152 2.94238C15.1152 1.59368 16.2089 0.500118 17.5576 0.5Z"
            fill="#ABABAB" />
        </svg>

        <a style="font-size: 18px;font-weight: 700; margin-left: 30px;">Sales</a>
        <a href="/" class="active">Home </a>

        <!-- By Employees -->
        <div style="position: relative; display: inline-block;" id="employeeWrapper">
          <a href="javascript:void(0);" onclick="toggleDropdown('employeeFilter')" style="display: inline-block;">
            By Employees
            <svg width="14" height="9" viewBox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M13.6651 2.29992L7.35745 8.66916C7.17284 8.85377 6.86514 8.85377 6.68053 8.66916L0.372837 2.29992C0.188221 2.11531 0.188221 1.80762 0.372837 1.623L1.04976 0.946079C1.23438 0.761463 1.54207 0.761463 1.72668 0.946079L6.68053 5.96146C6.86514 6.14608 7.17284 6.14608 7.35745 5.96146L12.3113 0.976848C12.4959 0.792233 12.8036 0.792233 12.9882 0.976848L13.6651 1.65377C13.819 1.83839 13.819 2.11531 13.6651 2.29992Z"
                fill="#706E6B" />
            </svg>
          </a>
          <select id="employeeFilter" onchange="applyFilters()"
            style="display: none; position: absolute; top: 100%; left: 0; margin-top: 4px; padding: 6px; border-radius: 4px; border: 1px solid #ccc; background: white;">
            <option value="">-- Select --</option>
            <% const employeeSet=new Set(); enquiries.forEach(e=> employeeSet.add(e.account_owner));
              employeeSet.forEach(emp => {
              %>
              <option value="<%= emp %>">
                <%= emp %>
              </option>
              <% }) %>
          </select>
        </div>


        <!-- By City -->
        <div style="position: relative; display: inline-block;" id="cityWrapper">
          <a href="javascript:void(0);" onclick="toggleDropdown('cityFilter')" style="display: inline-block;">By City<svg
              width="14" height="9" viewBox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M13.6651 2.29992L7.35745 8.66916C7.17284 8.85377 6.86514 8.85377 6.68053 8.66916L0.372837 2.29992C0.188221 2.11531 0.188221 1.80762 0.372837 1.623L1.04976 0.946079C1.23438 0.761463 1.54207 0.761463 1.72668 0.946079L6.68053 5.96146C6.86514 6.14608 7.17284 6.14608 7.35745 5.96146L12.3113 0.976848C12.4959 0.792233 12.8036 0.792233 12.9882 0.976848L13.6651 1.65377C13.819 1.83839 13.819 2.11531 13.6651 2.29992Z"
                fill="#706E6B" />
            </svg>
          </a>
          <select id="cityFilter" onchange="applyFilters()"
            style="display: none; position: absolute; top: 100%; left: 0; margin-top: 4px; padding: 6px; border-radius: 4px; border: 1px solid #ccc; background: white;">
            <option value="">-- Select --</option>
            <% const citySet=new Set(); enquiries.forEach(e=> citySet.add(e.city));
              citySet.forEach(city => {
              %>
              <option value="<%= city %>">
                <%= city %>
              </option>
              <% }) %>
          </select>
        </div>


        <a href="#">Accounts
        </a>
        <a href="#">Reports<svg width="14" height="9" viewBox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M13.6651 2.29992L7.35745 8.66916C7.17284 8.85377 6.86514 8.85377 6.68053 8.66916L0.372837 2.29992C0.188221 2.11531 0.188221 1.80762 0.372837 1.623L1.04976 0.946079C1.23438 0.761463 1.54207 0.761463 1.72668 0.946079L6.68053 5.96146C6.86514 6.14608 7.17284 6.14608 7.35745 5.96146L12.3113 0.976848C12.4959 0.792233 12.8036 0.792233 12.9882 0.976848L13.6651 1.65377C13.819 1.83839 13.819 2.11531 13.6651 2.29992Z"
              fill="#706E6B" />
          </svg>
        </a>
      </div>

    <div class="section">
      <!-- Section: Opportunities Header and Actions -->
      <div class="section-header">
        <!-- Left: Opportunity Icon + All Employees -->
        <div class="left">
          <svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="36" height="36" rx="4" fill="#7F8DE1" />
            <mask id="mask0_14536_11183" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="0" y="0" width="36"
              height="36">
              <rect width="36" height="36" rx="4" fill="white" />
            </mask>
            <g mask="url(#mask0_14536_11183)">
              <path
                d="M29.4512 17.3086C29.6943 17.3087 30.2787 17.5366 30.3154 18.3125V28.373H19.0781V18.2598C19.0781 18.1733 19.2081 17.3086 20.0293 17.3086H29.4512ZM22.1035 24.0078C21.6281 24.0078 21.2393 24.3967 21.2393 24.8721V25.7363C21.2393 26.2117 21.6281 26.6006 22.1035 26.6006H22.9678C23.4432 26.6006 23.832 26.2118 23.832 25.7363V24.8721C23.832 24.3967 23.4432 24.0078 22.9678 24.0078H22.1035ZM26.4258 24.0078C25.9504 24.0078 25.5616 24.3967 25.5615 24.8721V25.7363C25.5615 26.2118 25.9504 26.6006 26.4258 26.6006H27.29C27.7654 26.6006 28.1543 26.2117 28.1543 25.7363V24.8721C28.1543 24.3967 27.7654 24.0078 27.29 24.0078H26.4258ZM22.1035 19.5996C21.6281 19.5996 21.2393 19.9885 21.2393 20.4639V21.3281C21.2393 21.8035 21.6281 22.1924 22.1035 22.1924H22.9678C23.4432 22.1924 23.832 21.8035 23.832 21.3281V20.4639C23.832 19.9884 23.4432 19.5996 22.9678 19.5996H22.1035ZM26.4258 19.5996C25.9504 19.5996 25.5615 19.9884 25.5615 20.4639V21.3281C25.5615 21.8035 25.9504 22.1924 26.4258 22.1924H27.29C27.7654 22.1924 28.1543 21.8035 28.1543 21.3281V20.4639C28.1543 19.9885 27.7654 19.5996 27.29 19.5996H26.4258Z"
                fill="white" />
              <path
                d="M20.8096 7.6272C21.0528 7.62735 21.6371 7.85532 21.6738 8.6311V13.8079C21.6737 14.1536 21.3279 14.6721 20.8525 14.6721H17.4385C16.4947 14.6721 16.4874 15.694 16.4873 15.7092V28.3733H5.25V8.57837C5.25 8.49193 5.37999 7.6272 6.20117 7.6272H20.8096ZM8.27539 23.5754C7.80005 23.5755 7.41125 23.9644 7.41113 24.4397V25.304C7.41113 25.7794 7.79998 26.1692 8.27539 26.1692H9.13965C9.61507 26.1692 10.0039 25.7794 10.0039 25.304V24.4397C10.0038 23.9644 9.615 23.5754 9.13965 23.5754H8.27539ZM13.0293 23.5754C12.5541 23.5756 12.1652 23.9645 12.165 24.4397V25.304C12.165 25.7793 12.554 26.169 13.0293 26.1692H13.8945C14.3697 26.1689 14.7588 25.7792 14.7588 25.304V24.4397C14.7587 23.9645 14.3697 23.5757 13.8945 23.5754H13.0293ZM8.27539 19.1243C7.79998 19.1243 7.41113 19.5131 7.41113 19.9885V20.8528C7.41122 21.3281 7.80004 21.717 8.27539 21.717H9.13965C9.61502 21.717 10.0038 21.3281 10.0039 20.8528V19.9885C10.0039 19.5131 9.61507 19.1243 9.13965 19.1243H8.27539ZM13.0293 19.1243C12.554 19.1245 12.165 19.5132 12.165 19.9885V20.8528C12.1651 21.328 12.5541 21.7168 13.0293 21.717H13.8945C14.3697 21.7168 14.7587 21.328 14.7588 20.8528V19.9885C14.7588 19.5133 14.3697 19.1245 13.8945 19.1243H13.0293ZM8.27539 14.7151C7.80011 14.7151 7.41135 15.1041 7.41113 15.5793V16.4446C7.41137 16.9198 7.80013 17.3088 8.27539 17.3088H9.13965C9.61493 17.3088 10.0037 16.9198 10.0039 16.4446V15.5793C10.0037 15.1041 9.61494 14.7151 9.13965 14.7151H8.27539ZM13.0293 14.7151C12.5542 14.7153 12.1653 15.1042 12.165 15.5793V16.4446C12.1653 16.9197 12.5542 17.3086 13.0293 17.3088H13.8945C14.3696 17.3086 14.7586 16.9197 14.7588 16.4446V15.5793C14.7586 15.1043 14.3696 14.7153 13.8945 14.7151H13.0293ZM8.27539 10.3069C7.80002 10.3069 7.4112 10.6958 7.41113 11.1711V12.0354C7.41113 12.5108 7.79998 12.8996 8.27539 12.8997H9.13965C9.61507 12.8997 10.0039 12.5108 10.0039 12.0354V11.1711C10.0038 10.6958 9.61503 10.3069 9.13965 10.3069H8.27539ZM13.0293 10.3069C12.5541 10.3071 12.1651 10.6959 12.165 11.1711V12.0354C12.165 12.5107 12.554 12.8995 13.0293 12.8997H13.8945C14.3697 12.8994 14.7588 12.5107 14.7588 12.0354V11.1711C14.7587 10.6959 14.3697 10.3071 13.8945 10.3069H13.0293ZM17.7842 10.3069C17.3088 10.3069 16.92 10.6958 16.9199 11.1711V12.0354C16.9199 12.5108 17.3088 12.8997 17.7842 12.8997H18.6484C19.1238 12.8996 19.5127 12.5108 19.5127 12.0354V11.1711C19.5126 10.6958 19.1238 10.307 18.6484 10.3069H17.7842Z"
                fill="white" />
            </g>
          </svg>

          <div class="left2">
            <div class="subtitle">Opportunities</div>
            <div class="title">All Employees<svg width="16" height="17" viewBox="0 0 16 17" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M2.84059 4.80762H13.1737C13.4656 4.80762 13.67 5.20762 13.4364 5.48454L8.38663 12.0076C8.21149 12.2538 7.83203 12.2538 7.65689 12.0076L2.54869 5.48454C2.34437 5.20762 2.51951 4.80762 2.84059 4.80762Z"
                  fill="#3E3E3C" />
              </svg>

            </div>
          </div>
        </div>

        <!-- Right: Buttons -->
        <div class="right">
          <button style="border-radius: 4px 0px 0px 4px;" onclick="openForm1()">New</button>
          <button style="border-radius: 0px; border-left: none;border-right: none;">Import</button>
          <button style="border-radius: 0px 4px 4px 0px;">Export</button>
        </div>
      </div>

      <!-- Search + Info Row -->
      <div class="search-info">
        <!-- Left Info -->
        <!-- <div class="left">3 items • Sorted by Opportunity Name • Filtered by All Employees • Updated 4 minutes ago</div> -->
         <div class="left" id="filterStatus">
             <%= enquiries.length %>  items • Sorted by Opportunity Name • Filtered by All Employees • Updated just now
            </div>
        <!-- Search and icons -->
        <div class="right">
          <div class="icons-filter">

            <input type="text" id="searchInput" placeholder="Search this list..." onkeyup="filterTable()" />

            <div class="icon" style="width: 50px;">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M14.3113 0.615479H1.69591C1.44976 0.615479 1.23438 0.830863 1.23438 1.07702V2.61548C1.23438 2.86163 1.44976 3.07702 1.69591 3.07702H14.3113C14.5575 3.07702 14.7728 2.86163 14.7728 2.61548V1.07702C14.7728 0.830863 14.5575 0.615479 14.3113 0.615479ZM4.46514 4.30779H1.69591C1.44976 4.30779 1.23438 4.52317 1.23438 4.76932V5.6924C1.23438 5.93856 1.44976 6.15394 1.69591 6.15394H4.46514C4.7113 6.15394 4.92668 5.93856 4.92668 5.6924V4.76932C4.92668 4.52317 4.7113 4.30779 4.46514 4.30779ZM9.38822 4.30779H6.61899C6.37284 4.30779 6.15745 4.52317 6.15745 4.76932V5.6924C6.15745 5.93856 6.37284 6.15394 6.61899 6.15394H9.38822C9.63438 6.15394 9.84976 5.93856 9.84976 5.6924V4.76932C9.84976 4.52317 9.63438 4.30779 9.38822 4.30779ZM14.3113 4.30779H11.5421C11.2959 4.30779 11.0805 4.52317 11.0805 4.76932V5.6924C11.0805 5.93856 11.2959 6.15394 11.5421 6.15394H14.3113C14.5575 6.15394 14.7728 5.93856 14.7728 5.6924V4.76932C14.7728 4.52317 14.5575 4.30779 14.3113 4.30779ZM4.46514 7.38471H1.69591C1.44976 7.38471 1.23438 7.60009 1.23438 7.84625V8.76932C1.23438 9.01548 1.44976 9.23086 1.69591 9.23086H4.46514C4.7113 9.23086 4.92668 9.01548 4.92668 8.76932V7.84625C4.92668 7.60009 4.7113 7.38471 4.46514 7.38471ZM9.38822 7.38471H6.61899C6.37284 7.38471 6.15745 7.60009 6.15745 7.84625V8.76932C6.15745 9.01548 6.37284 9.23086 6.61899 9.23086H9.38822C9.63438 9.23086 9.84976 9.01548 9.84976 8.76932V7.84625C9.84976 7.60009 9.63438 7.38471 9.38822 7.38471ZM14.3113 7.38471H11.5421C11.2959 7.38471 11.0805 7.60009 11.0805 7.84625V8.76932C11.0805 9.01548 11.2959 9.23086 11.5421 9.23086H14.3113C14.5575 9.23086 14.7728 9.01548 14.7728 8.76932V7.84625C14.7728 7.60009 14.5575 7.38471 14.3113 7.38471ZM4.46514 10.4616H1.69591C1.44976 10.4616 1.23438 10.677 1.23438 10.9232V11.8462C1.23438 12.0924 1.44976 12.3078 1.69591 12.3078H4.46514C4.7113 12.3078 4.92668 12.0924 4.92668 11.8462V10.9232C4.92668 10.677 4.7113 10.4616 4.46514 10.4616ZM9.38822 10.4616H6.61899C6.37284 10.4616 6.15745 10.677 6.15745 10.9232V11.8462C6.15745 12.0924 6.37284 12.3078 6.61899 12.3078H9.38822C9.63438 12.3078 9.84976 12.0924 9.84976 11.8462V10.9232C9.84976 10.677 9.63438 10.4616 9.38822 10.4616ZM14.3113 10.4616H11.5421C11.2959 10.4616 11.0805 10.677 11.0805 10.9232V11.8462C11.0805 12.0924 11.2959 12.3078 11.5421 12.3078H14.3113C14.5575 12.3078 14.7728 12.0924 14.7728 11.8462V10.9232C14.7728 10.677 14.5575 10.4616 14.3113 10.4616ZM4.46514 13.5386H1.69591C1.44976 13.5386 1.23438 13.7539 1.23438 14.0001V14.9232C1.23438 15.1693 1.44976 15.3847 1.69591 15.3847H4.46514C4.7113 15.3847 4.92668 15.1693 4.92668 14.9232V14.0001C4.92668 13.7539 4.7113 13.5386 4.46514 13.5386ZM9.38822 13.5386H6.61899C6.37284 13.5386 6.15745 13.7539 6.15745 14.0001V14.9232C6.15745 15.1693 6.37284 15.3847 6.61899 15.3847H9.38822C9.63438 15.3847 9.84976 15.1693 9.84976 14.9232V14.0001C9.84976 13.7539 9.63438 13.5386 9.38822 13.5386ZM14.3113 13.5386H11.5421C11.2959 13.5386 11.0805 13.7539 11.0805 14.0001V14.9232C11.0805 15.1693 11.2959 15.3847 11.5421 15.3847H14.3113C14.5575 15.3847 14.7728 15.1693 14.7728 14.9232V14.0001C14.7728 13.7539 14.5575 13.5386 14.3113 13.5386Z"
                  fill="#706E6B" />
              </svg>
              <svg  width="10" height="10" viewBox="-2 -2 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M1.4242 2.15381H6.59077C6.73672 2.15381 6.83889 2.35381 6.72213 2.49227L4.19722 5.75381C4.10965 5.87689 3.91992 5.87689 3.83235 5.75381L1.27825 2.49227C1.17609 2.35381 1.26366 2.15381 1.4242 2.15381Z"
                  fill="#706E6B" />
              </svg>

            </div>
            <div class="icon"><svg onclick="resetFilters()" style="cursor:pointer;" width="16" height="16" viewBox="0 0 16 16" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M14.3431 1.23071H13.42C13.1739 1.23071 12.9585 1.4461 12.9585 1.69225V3.8461C12.9585 4.12302 12.8047 4.2461 12.5893 4.06148C12.497 3.93841 12.4047 3.8461 12.2816 3.75379C10.7431 2.21533 8.58927 1.56917 6.37389 1.99994C5.60466 2.15379 4.86619 2.46148 4.22004 2.89225C2.34312 4.12302 1.26619 6.12302 1.23543 8.27687C1.20466 9.93841 1.85081 11.5999 3.02004 12.7999C4.25081 14.0922 5.91235 14.7999 7.69696 14.7999C9.26619 14.7999 10.7431 14.2461 11.9123 13.2615C12.1277 13.0769 12.1277 12.7692 11.9431 12.5846L11.297 11.9384C11.1431 11.7846 10.8662 11.7538 10.6816 11.9076C9.57389 12.8307 8.06619 13.1999 6.5585 12.8307C6.1585 12.7384 5.7585 12.5538 5.38927 12.3384C3.63543 11.2615 2.80466 9.23071 3.29696 7.19994C3.38927 6.79994 3.57389 6.39994 3.78927 6.03071C4.65081 4.52302 6.1585 3.69225 7.7585 3.69225C8.98927 3.69225 10.1585 4.18456 11.02 5.0461C11.1739 5.16917 11.297 5.32302 11.3893 5.47687C11.4816 5.72302 11.2662 5.8461 10.9893 5.8461H8.83543C8.58927 5.8461 8.37389 6.06148 8.37389 6.30764V7.26148C8.37389 7.50764 8.5585 7.69225 8.80466 7.69225H14.4354C14.6508 7.69225 14.8354 7.50764 14.8354 7.29225V1.69225C14.8047 1.4461 14.5893 1.23071 14.3431 1.23071V1.23071Z"
                  fill="#706E6B" />
              </svg>
            </div>
            <div class="icon"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M14.013 7.15384L7.70536 10.6308C7.27459 10.8461 6.78228 10.5385 6.78228 10.0769V2.53845C6.78228 2.23076 6.47459 1.98461 6.19766 2.07691C3.12074 2.93845 0.905356 5.92307 1.27459 9.33845C1.61305 12.4461 4.10536 14.9692 7.24382 15.3077C11.3361 15.7385 14.7823 12.5692 14.7823 8.56922C14.7823 8.19999 14.7515 7.83076 14.69 7.46153C14.6284 7.15384 14.29 6.99999 14.013 7.15384ZM8.53613 8.56922L14.5977 5.33845C14.9669 5.15384 15.09 4.66153 14.8438 4.32307C13.4592 2.41537 11.3054 1.03076 8.84382 0.630759C8.41305 0.538451 8.01305 0.876913 8.01305 1.30768V8.26153C8.01305 8.53845 8.28997 8.6923 8.53613 8.56922Z"
                  fill="#706E6B" />
              </svg>
            </div>
            <div class="icon"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M14.8017 1.23071H1.14017C0.678627 1.23071 0.463243 1.75379 0.740166 2.09225L6.7094 9.07687C6.89401 9.29225 6.98632 9.59994 6.98632 9.87687V14.3076C6.98632 14.5538 7.23247 14.7692 7.47863 14.7692H8.4017C8.64786 14.7692 8.83247 14.5538 8.83247 14.3076V9.87687C8.83247 9.56917 8.95555 9.29225 9.17093 9.07687L15.2017 2.09225C15.4786 1.75379 15.2632 1.23071 14.8017 1.23071V1.23071Z"
                  fill="#706E6B" />
              </svg>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Table -->
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Opportunity Name <svg width="9" height="12" viewBox="0 0 9 12" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M0.443149 7.38463C0.258534 7.56925 0.258534 7.8231 0.443149 8.00771L3.90469 11.4C4.0893 11.5846 4.36623 11.5846 4.55084 11.4L8.03546 8.00771C8.22007 7.8231 8.22007 7.56925 8.03546 7.38463L7.3893 6.76156C7.20469 6.57694 6.92776 6.57694 6.74315 6.76156L5.65853 7.8231C5.47392 8.00771 5.15084 7.89233 5.15084 7.6154V1.38463C5.15084 1.15386 4.94315 0.923096 4.6893 0.923096H3.76623C3.51238 0.923096 3.30469 1.17694 3.30469 1.38463V7.6154C3.30469 7.89233 2.98161 8.00771 2.797 7.8231L1.71238 6.76156C1.52776 6.57694 1.25084 6.57694 1.06623 6.76156L0.443149 7.38463Z"
                  fill="#706E6B" />
              </svg>
            </th>
            <th>City <svg width="12" height="7" viewBox="0 0 12 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M10.995 1.34994L6.26418 6.12687C6.12572 6.26533 5.89495 6.26533 5.75649 6.12687L1.02572 1.34994C0.88726 1.21148 0.88726 0.980713 1.02572 0.842251L1.53341 0.334559C1.67188 0.196097 1.90264 0.196097 2.04111 0.334559L5.75649 4.0961C5.89495 4.23456 6.12572 4.23456 6.26418 4.0961L9.97957 0.357636C10.118 0.219174 10.3488 0.219174 10.4873 0.357636L10.995 0.865328C11.1103 1.00379 11.1103 1.21148 10.995 1.34994Z"
                  fill="#706E6B" />
              </svg>
            </th>
            <th>Stage<svg width="12" height="7" viewBox="0 0 12 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M10.995 1.34994L6.26418 6.12687C6.12572 6.26533 5.89495 6.26533 5.75649 6.12687L1.02572 1.34994C0.88726 1.21148 0.88726 0.980713 1.02572 0.842251L1.53341 0.334559C1.67188 0.196097 1.90264 0.196097 2.04111 0.334559L5.75649 4.0961C5.89495 4.23456 6.12572 4.23456 6.26418 4.0961L9.97957 0.357636C10.118 0.219174 10.3488 0.219174 10.4873 0.357636L10.995 0.865328C11.1103 1.00379 11.1103 1.21148 10.995 1.34994Z"
                  fill="#706E6B" />
              </svg>
            </th>
            <th>Phone<svg width="12" height="7" viewBox="0 0 12 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M10.995 1.34994L6.26418 6.12687C6.12572 6.26533 5.89495 6.26533 5.75649 6.12687L1.02572 1.34994C0.88726 1.21148 0.88726 0.980713 1.02572 0.842251L1.53341 0.334559C1.67188 0.196097 1.90264 0.196097 2.04111 0.334559L5.75649 4.0961C5.89495 4.23456 6.12572 4.23456 6.26418 4.0961L9.97957 0.357636C10.118 0.219174 10.3488 0.219174 10.4873 0.357636L10.995 0.865328C11.1103 1.00379 11.1103 1.21148 10.995 1.34994Z"
                  fill="#706E6B" />
              </svg>
            </th>
            <th>Type<svg width="12" height="7" viewBox="0 0 12 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M10.995 1.34994L6.26418 6.12687C6.12572 6.26533 5.89495 6.26533 5.75649 6.12687L1.02572 1.34994C0.88726 1.21148 0.88726 0.980713 1.02572 0.842251L1.53341 0.334559C1.67188 0.196097 1.90264 0.196097 2.04111 0.334559L5.75649 4.0961C5.89495 4.23456 6.12572 4.23456 6.26418 4.0961L9.97957 0.357636C10.118 0.219174 10.3488 0.219174 10.4873 0.357636L10.995 0.865328C11.1103 1.00379 11.1103 1.21148 10.995 1.34994Z"
                  fill="#706E6B" />
              </svg>
            </th>

            <th>Account Owner<svg width="12" height="7" viewBox="0 0 12 7" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M10.995 1.34994L6.26418 6.12687C6.12572 6.26533 5.89495 6.26533 5.75649 6.12687L1.02572 1.34994C0.88726 1.21148 0.88726 0.980713 1.02572 0.842251L1.53341 0.334559C1.67188 0.196097 1.90264 0.196097 2.04111 0.334559L5.75649 4.0961C5.89495 4.23456 6.12572 4.23456 6.26418 4.0961L9.97957 0.357636C10.118 0.219174 10.3488 0.219174 10.4873 0.357636L10.995 0.865328C11.1103 1.00379 11.1103 1.21148 10.995 1.34994Z"
                  fill="#706E6B" />
              </svg>
            </th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% enquiries.forEach((row, index)=> { %>
            <tr>
              <td>
                <%= index + 1 %>
              </td>
              <td>
                <a class="text-blue" href="/enquiry/<%= row.id %>">
                  <%= row.name %>
                </a>
              </td>
              <td>
                <%= row.city %>
              </td>
              <td>
                <%= row.action_type || '-' %>
              </td>
              <td>
                <%= row.mobile_number %>
              </td>
              <td>
                <%= row.customer_type %>
              </td>
              <td>
                <%= row.account_owner %>
              </td>
              <td><svg class="edit-btn btn btn-primary" data-id="<%= row.id %>" width="20" height="20"
                  viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect x="0.5" y="0.5" width="19" height="19" rx="3.5" fill="white" />
                  <rect x="0.5" y="0.5" width="19" height="19" rx="3.5" stroke="#DDDBDA" />
                  <path fill-rule="evenodd" clip-rule="evenodd"
                    d="M5.48845 6.76929H14.53C14.7854 6.76929 14.9641 7.11929 14.7598 7.36159L10.3412 13.0693C10.188 13.2847 9.85595 13.2847 9.70271 13.0693L5.23304 7.36159C5.05425 7.11929 5.2075 6.76929 5.48845 6.76929Z"
                    fill="#706E6B" />
                </svg>
              </td>
            </tr>
            <% }) %>
        </tbody>
      </table>
    </div>

    <!-- Modal 1 -->
    <div id="form1" class="modal">
      <div class="modal-content">
   <form id="accountForm">
  <h2 class="form-title">New Opportunity</h2>
  <hr class="form-underline">
  <p class="required-note"><span class="required-star">*</span> = Required Information</p>

  <div class="form-section">
    <p class="section-heading">Opportunity Details</p>

    <label>Account Owner</label>
    <p class="owner-display"><%= user.name %></p>

    <label>*Company Name</label>
    <input type="text" name="name" id="companyName" required>

    <div class="row">
      <div class="half">
        <label>*Poc Name</label>
        <input type="text" name="poc" id="pocName" required pattern="^[a-zA-Z\s]+$" title="Only alphabets allowed">
      </div>
      <div class="half">
        <label>*Mobile Number</label>
        <input type="text" name="mobile" id="mobile" required pattern="^[0-9]{10}$" title="Enter a valid 10-digit mobile number">
      </div>
    </div>

   <div class="row">
      <div class="half">
        <label>*City</label>
        <input type="text" name="city" id="cityInput" list="cityList" required>
        <datalist id="cityList">
          <option value="Gandhinagar">
          <option value="Ahmedabad">
          <option value="Mumbai">
          <option value="Surat">
          <option value="Rajkot">
          <option value="Baroda">
              <option value="UdaiPur">
        </datalist>
      </div>
      <div class="half">
        <label>*Email Address</label>
        <input type="email" name="email" required>
      </div>
    </div>

    <label>*Type</label>
    <select name="type" required>
      <option value="">--None--</option>
      <option value="Customer - Direct">Customer - Direct</option>
      <option value="Regional Agency">Regional Agency</option>
    </select>
  </div>

  <div class="form-actions">
    <button type="button" onclick="closeAll()" class="btn cancel">Cancel</button>
    <button type="submit" onclick="submitForm1(event, 'save_new')" class="btn secondary">Save & New</button>
    <button type="submit" onclick="submitForm1(event, 'save')" class="btn primary">Save</button>
  </div>
</form>
      </div>
    </div>


    <!-- Modal 2 -->
    <div id="form2" class="modal">
      <div class="modal-content">
        <form id="fullForm" enctype="multipart/form-data">

          <input type="hidden" name="entry_id" value="">
          <h2 class="form-title">Edit Opportunity</h2>
          <hr class="form-underline">
          <p class="required-note"><span class="required-star">*</span> = Required Information</p>

          <!-- <h3>Next Action</h3> -->
          <!-- <label>Account Owner</label>
              <input type="text" value="<%= user.name %>" disabled> -->
          <div class="row" style="display: flex; justify-content: space-between;align-items: center;">
            <div class="half">
              <label>Account Owner</label>
              <p class="owner-display">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect width="20" height="20" rx="10" fill="#EBEBEB" />
                  <path fill-rule="evenodd" clip-rule="evenodd"
                    d="M15.5379 13.923V14.4307C15.5379 15.0307 15.0302 15.5384 14.4302 15.5384H5.56863C4.96863 15.5384 4.46094 15.0307 4.46094 14.4307V13.923C4.46094 12.5845 6.03017 11.7538 7.50709 11.1076L7.64555 11.0384C7.76094 10.9922 7.87632 10.9922 7.99171 11.0615C8.59171 11.4538 9.26094 11.6615 9.97632 11.6615C10.6917 11.6615 11.384 11.4307 11.9609 11.0615C12.0763 10.9922 12.1917 10.9922 12.3071 11.0384L12.4456 11.1076C13.9686 11.7538 15.5379 12.5615 15.5379 13.923ZM9.99942 4.46143C11.5225 4.46143 12.7456 5.82297 12.7456 7.50758C12.7456 9.1922 11.5225 10.5537 9.99942 10.5537C8.47634 10.5537 7.25326 9.1922 7.25326 7.50758C7.25326 5.82297 8.47634 4.46143 9.99942 4.46143Z"
                    fill="#768191" />
                </svg>
                <%= user.name %>
              </p>
            </div>
            <div class="form-group half" style="position: relative;">
              <div id="formMessage" style="color: red; margin-bottom: 10px;"></div>
              <label>Action:</label>
              <select name="action" id="actionSelect" required onchange="handleActionChange(this.value)">
                <option value="">Select</option>
                <option value="Send Proposal">Send Proposal</option>
                <option value="Send Follow-up Email">Send Follow-up Email</option>
                <option value="Send Offer">Send Offer</option>
                <option value="Send Tax Invoice">Send Tax Invoice</option>
                <option value="Closed Won">Closed Won</option>
              </select>
              <button type="button" onclick="clearActionFields()"
                style="position: absolute;right: 0px;bottom: -7px;display: none;">Clear
                Fields</button>
            </div>
          </div>
          <!-- <div id="previewInfo"></div> -->
          <div class="row">
            <div class="half">
              <label>*Opportunity Name</label>
              <input type="text" name="name" readonly>
            </div>
            <div class="half">
              <label>*Mobile Number</label>
              <input type="text" name="mobile" readonly>
            </div>
          </div>

          <div class="row">
            <div class="half">
              <label>*City</label>
              <input type="text" name="city" readonly>
            </div>
            <div class="half">
              <label>*Email Address</label>
              <input type="email" name="email" readonly>
            </div>
          </div>

          <label>*Type</label>
          <select name="type" readonly>
            <option value="">--None--</option>
            <option value="Customer - Direct">Customer - Direct</option>
            <option value="Regional Agency">Regional Agency</option>
          </select>


          <div id="proposalFields" style="display:none;">
            <label>Email Subject:</label>
            <input type="text" name="email_subject" />
            <label>Email Body:</label>
            <textarea name="email_body"></textarea>
          </div>

          <div id="followupFields" style="display:none;">
            <label>Follow-up Email Subject:</label>
            <input type="text" name="followup_email_sub" />
            <label>Follow-up Email Body:</label>
            <textarea name="followup_email_body"></textarea>
          </div>


          <div id="offerFields" style="display: none;">

            <div class="row">
              <div class="half">
                <label>Start Date:</label>
                <input type="date" name="start_date" id="start_date"
                  onchange="calculateEndDate('start_date','duration','end_date','end_date_display')" oninput="calculateEndDate('start_date','duration','end_date','end_date_display')"  />
              </div>
              <div class="half">
                <label>Duration (Days):</label>
                <input type="number" style="margin-top: 10px;" name="duration" id="duration"
                  onchange="calculateEndDate('start_date','duration','end_date','end_date_display')" oninput="calculateEndDate('start_date','duration','end_date','end_date_display')"  />
                <input type="text" name="end_date" id="end_date" readonly style="display: none;" />
                <small id="end_date_display" style="color: red;">(Ends on: DD/MM/YYYY)</small>
              </div>
            </div>
            <div class="component-block" style="margin-top: 10px;">


              <div class="row">
                <div class="half">
                  <label>*No. of Residential Screens</label>
                  <input type="number" name="residential_screen" placeholder="Screens" class="screen" data-type="r" />
                </div>
                <div class="half">
                  <label>*Offer Rate(per Screen per 30 Days)</label>
                  <input type="number" name="r_per_screen" placeholder="Per Screen Rate" class="rate" data-type="r" />
                </div>
                <div class="half" style="width: 250px;">
                  <label>Plan</label>
                  <!-- <input type="text" name="r_plan" value="720" class="plan" data-type="r"> -->
                  <select name="r_plan" class="plan" data-type="r">
                    <option value="720" selected>720</option>
                    <option value="360">360</option>
                  </select>
                </div>
                <div class="half">
                  <label>Card Rate(per Screen per 30 Days)</label>
                  <input type="text" value="3000" readonly />
                </div>
                <span class="result" id="r_result">₹0</span>
              </div>


              <div class="row">
                <div class="half">
                  <label>*No. of Corporate Screens</label>
                  <input type="number" name="corporate_screen" placeholder="Screens" class="screen" data-type="c" />
                </div>
                <div class="half">
                  <label>*Offer Rate(per Screen per 30 Days)</label>
                  <input type="number" name="c_per_screen" placeholder="Per Screen Rate" class="rate" data-type="c" />
                </div>
                <div class="half" style="width: 250px;">
                  <label>Plan</label>
                  <!-- <input type="text" name="c_plan" value="720" class="plan" data-type="c"> -->
                  <select name="c_plan" class="plan" data-type="c">
                    <option value="720" selected>720</option>
                    <option value="360">360</option>
                  </select>
                </div>
                <div class="half">
                  <label>Card Rate(per Screen per 30 Days)</label>
                  <input type="text" value="6000" readonly />
                </div>
                <span class="result" id="c_result">₹0</span>
              </div>


              <div class="row">
                <div class="half">
                  <label>*No. of Outdoor Screens</label>
                  <input type="number" name="outdoor_screen" placeholder="Screens" class="screen" data-type="o" />
                </div>
                <div class="half">
                  <label>*Offer Rate(per Screen per 30 Days)</label>
                  <input type="number" name="o_per_screen" placeholder="Per Screen Rate" class="rate" data-type="o" />
                </div>
                <div class="half" style="width: 250px;">
                  <label>Plan</label>
                  <!-- <input type="text" name="o_plan" value="720" class="plan" data-type="o"> -->
                  <select name="o_plan" class="plan" data-type="o">
                    <option value="720" selected>720</option>
                    <option value="360">360</option>
                  </select>
                </div>
                <div class="half">
                  <label>Card Rate(per Screen per 30 Days)</label>
                  <input type="text" value="10000" readonly />
                </div>
                <span class="result" id="o_result">₹0</span>
              </div>


              <div><strong>Total Amount:</strong> <span id="total_amount">₹0</span></div>
          <input type="hidden" name="total_offer_amount" id="total_amount_input" />

            </div>


            <label>Note:</label>
            <div class="form-row">
              <textarea name="note" placeholder="Enter note..."></textarea>
            </div>
          </div>

          <!-- <div id="closedWonFields" style="display:none;">
            <label>*Amount:</label>
            <input type="number" name="amount" />
    
            <label>*Purchase Order/Email Confirmation (PDF only):</label>
            <input type="file" name="confirmation_pdf" accept="application/pdf" />
          </div> -->

          <div id="closedWonFields" style="display: none;">
            <div class="form-group">
              <label for="amount">*Amount:</label>
              <input type="number" id="amount" name="amount" placeholder="₹5,00,000.00" />
            </div>

            <div class="form-group">
              <label for="confirmation_pdf">*Purchase Order/Email Confirmation:</label>

              <label for="confirmation_file" class="upload-box">
                <svg xmlns="http://www.w3.org/2000/svg" class="upload-icon" viewBox="0 0 24 24" fill="none">
                  <path d="M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2" stroke="#1D4ED8" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round" />
                  <path d="M7 9l5-5 5 5" stroke="#1D4ED8" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
                  <path d="M12 4v12" stroke="#1D4ED8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                <span style="color: #0D6EFD;">Click To Upload</span>
              </label>
              <input type="file" id="confirmation_file" name="confirmation_file" accept=".pdf,image/*" hidden />


              <div class="uploaded-file">
                <svg xmlns="http://www.w3.org/2000/svg" class="file-icon" viewBox="0 0 24 24" fill="none">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="#6B7280" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round" />
                  <path d="M14 2v6h6" stroke="#6B7280" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
                </svg>
                <span id="confirmation_filename">No File Selected</span>
              </div>
              <div id="existing-confirmation-file"></div>

              <p class="hint-text">
                If the PDF of the PO is not avail, please upload a screenshot of email confirmation
              </p>
            </div>
          </div>

          <script>
            // Handle file input change
            document.getElementById('confirmation_file').addEventListener('change', function () {
              const file = this.files[0];
              if (file) {
                document.querySelector('.uploaded-file span').textContent = file.name;
              }

            });
          </script>


          <!-- Tax Invoice Fields -->
          <div id="taxInvoiceFields" style="display: none; margin-top: 20px;">
            <!-- <h3>Tax Invoice Details</h3> -->
            <div class="row">
              <div class="half">
                <label>Invoice No</label>
                <input type="text" name="invoice_no" placeholder="Invoice No" />
              </div>

              <div class="half">
                <label>Invoice Date</label>
                <input type="date" name="invoice_date" placeholder="Invoice Date" />
              </div>
            </div>
            <div class="row">
              <div class="half">
                <label>PO No.</label>
                <input type="text" name="po_no" placeholder="PO No." />
              </div>
              <div class="half">
                <label>PO Date</label>
                <input type="date" name="po_date" placeholder="PO Date" />
              </div>
            </div>
            <!--  <div class="row">
                      <input type="text" name="GST_No" placeholder="GST_No" />
                      <input type="text" name="pan_No" placeholder="pan_No" />
                      <input type="Website" name="Website" placeholder="Website" />
                      </div> -->

            <div class="row">
              <div class="half">
                <label>Place of Supply</label>
                <input type="text" name="place_of_supply" placeholder="Place of Supply" />
              </div>
              <div class="half">
                <label>Payment Terms</label>
                <input type="text" name="payment_terms" placeholder="Payment Terms" />
              </div>
            </div>

            <div class="row">
              <div class="half">
                <label>Acknowledgment No.</label>
                <input type="text" name="ack_no" placeholder="Acknowledgment No." />
              </div>
              <div class="half">
                <label>Acknowledgment Date</label>
                <input type="date" name="ack_date" placeholder="Acknowledgment Date" />
              </div>
            </div>

            <div class="row">
              <div class="half">
                <label>IRN</label>
                <input type="text" name="irn" placeholder="IRN" />
              </div>
              <div class="half">
                <label>SPOC</label>
                <input type="text" name="spoc" placeholder="SPOC" />
              </div>

            </div>
            <div class="half">
              <label>Billing Address</label>
              <textarea name="billing_address" placeholder="Billing Address"></textarea>
            </div>
            <div class="row">
              <div class="half">
                <label>Start Date:</label>
                <input type="date" name="t_start_date" id="start_datee"
                  onchange="calculateEndDate('start_datee','durationn','end_datee','end_date_displayy')" oninput="calculateEndDate('start_datee','durationn','end_datee','end_date_displayy')"/>
              </div>
              <div class="half">
                <label>Duration (Days):</label>
                <input type="number" style="margin-top: 10px;" name="t_duration" id="durationn"
                  onchange="calculateEndDate('start_datee','durationn','end_datee','end_date_displayy')" oninput="calculateEndDate('start_datee','durationn','end_datee','end_date_displayy')"/>
                <input type="text" name="t_end_date" id="end_datee" readonly style="display: none;" />
                <small id="end_date_displayy" style="color: red;">(Ends on: DD/MM/YYYY)</small>
              </div>


            </div>
            <!-- <h4>Residential</h4> -->
            <div class="row" style="margin-top: 10px;">
              <div class="half">
                <label>*No. of Residential Screens</label>
                <input type="number" name="t_residential_screen" placeholder="Screens" class="screen" data-type="r" />
              </div>
              <div class="half">
                <label>Offer Rate(per Screen per 30 Days)</label>
                <input type="number" name="t_r_per_screen" placeholder="Per Screen Rate" class="rate" data-type="r" />
              </div>
              <div class="half">
                <label>Plan</label>
                <!-- <input type="number" name="r_plan" placeholder="Plan Days" class="plan" data-type="r" /> -->
                <select name="t_r_plan" class="plan" data-type="r">
                  <option value="720" selected>720</option>
                  <option value="360">360</option>
                </select>
              </div>
              <div class="half">
                <label>Card Rate(per Screen per 30 Days)</label>
                <input type="text" value="10000" readonly />
              </div>
              <span class="result" id="r_result">₹0</span>
            </div>

            <!-- <h4>Corporate</h4> -->
            <div class="row">
              <div class="half">
                <label>*No. of Corporate Screens</label>
                <input type="number" name="t_corporate_screen" placeholder="Screens" class="screen" data-type="c" />
              </div>
              <div class="half">
                <label>Offer Rate(per Screen per 30 Days)</label>
                <input type="number" name="t_c_per_screen" placeholder="Per Screen Rate" class="rate" data-type="c" />
              </div>
              <div class="half">
                <label>Plan</label>
                <!-- <input type="number" name="c_plan" placeholder="Plan Days" class="plan" data-type="c" /> -->
                <select name="t_c_plan" class="plan" data-type="c">
                  <option value="720" selected>720</option>
                  <option value="360">360</option>
                </select>
              </div>
              <div class="half">
                <label>Card Rate(per Screen per 30 Days)</label>
                <input type="text" value="10000" readonly />
              </div>
              <span class="result" id="c_result">₹0</span>
            </div>

            <!-- <h4>Outdoor</h4> -->
            <div class="row">
              <div class="half">
                <label>*No. of Outdoor Screens</label>
                <input type="number" name="t_outdoor_screen" placeholder="Screens" class="screen" data-type="o" />
              </div>
              <div class="half">
                <label>Offer Rate(per Screen per 30 Days)</label>
                <input type="number" name="t_o_per_screen" placeholder="Per Screen Rate" class="rate" data-type="o" />
              </div>
              <div class="half">
                <label>Plan</label>
                <!-- <input type="number" name="o_plan" placeholder="Plan Days" class="plan" data-type="o" /></div> -->
                <select name="t_o_plan" class="plan" data-type="o">
                  <option value="720" selected>720</option>
                  <option value="360">360</option>
                </select>
              </div>

              <div class="half">
                <label>Card Rate(per Screen per 30 Days)</label>
                <input type="text" value="10000" readonly />
              </div>
              <span class="result" id="o_result">₹0</span>
            </div>


            <label>Note:</label>
            <div class="form-row">
              <textarea name="t_note" placeholder="Enter note..."></textarea>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn" onclick="closeAll()">Cancel</button>
            <button type="submit">Save</button>
          </div>
        </form>
      </div>
    </div>



  </div>



  <script>

    function handleActionChange(value) {
      const proposalFieldsFilled = document.querySelector('#proposalFields input[type="text"]').value !== '' || document.querySelector('#proposalFields textarea').value !== '';
      const followupFieldsFilled = document.querySelector('#followupFields input[type="text"]').value !== '' || document.querySelector('#followupFields textarea').value !== '';
      const offerFieldsFilled = document.querySelector('#offerFields input[type="date"]').value !== '' || document.querySelector('#offerFields input[type="number"]').value !== '' || document.querySelector('#offerFields textarea').value !== '';
      const closedWonFieldsFilled = document.querySelector('#closedWonFields input[type="number"]').value !== '' || document.querySelector('#closedWonFields input[type="file"]').value !== '';
      const taxInvoiceFieldsFilled = document.querySelector('#taxInvoiceFields input[type="text"]').value !== '' || document.querySelector('#taxInvoiceFields input[type="date"]').value !== '' || document.querySelector('#taxInvoiceFields textarea').value !== '';

      const formMessage = document.getElementById('formMessage');
      const actionSelect = document.getElementById('actionSelect');

      // if (proposalFieldsFilled || followupFieldsFilled || offerFieldsFilled || closedWonFieldsFilled || taxInvoiceFieldsFilled) {
      //   formMessage.textContent = 'First you filled fields. Clear them before you can select another action type.';
      //   actionSelect.value = ''; // Reset the select to the "Select" option
      //   document.getElementById('proposalFields').style.display = 'none';
      //   document.getElementById('followupFields').style.display = 'none';
      //   document.getElementById('offerFields').style.display = 'none';
      //   document.getElementById('closedWonFields').style.display = 'none';
      //   document.getElementById('taxInvoiceFields').style.display = 'none';
      // } else {
      formMessage.textContent = ''; // Clear the message
      document.getElementById('proposalFields').style.display = (value === 'Send Proposal') ? 'block' : 'none';
      document.getElementById('followupFields').style.display = (value === 'Send Follow-up Email') ? 'block' : 'none';
      document.getElementById('offerFields').style.display = (value === 'Send Offer') ? 'block' : 'none';
      document.getElementById('closedWonFields').style.display = (value === 'Closed Won') ? 'block' : 'none';
      document.getElementById('taxInvoiceFields').style.display = (value === 'Send Tax Invoice') ? 'block' : 'none';
      // }
    }

    function clearActionFields() {
      document.getElementById('proposalFields').style.display = 'none';
      document.querySelectorAll('#proposalFields input[type="text"], #proposalFields textarea').forEach(el => el.value = '');

      document.getElementById('followupFields').style.display = 'none';
      document.querySelectorAll('#followupFields input[type="text"], #followupFields textarea').forEach(el => el.value = '');

      document.getElementById('offerFields').style.display = 'none';
      document.querySelectorAll('#offerFields input[type="date"], #offerFields input[type="number"], #offerFields textarea').forEach(el => el.value = '');

      document.getElementById('closedWonFields').style.display = 'none';
      document.querySelectorAll('#closedWonFields input[type="number"], #closedWonFields input[type="file"]').forEach(el => {
        if (el.type === 'file') {
          el.value = ''; // Clearing file input requires setting value to empty string
        } else {
          el.value = '';
        }
      });

      document.getElementById('taxInvoiceFields').style.display = 'none';
      document.querySelectorAll('#taxInvoiceFields input[type="text"], #taxInvoiceFields input[type="date"], #taxInvoiceFields textarea').forEach(el => el.value = '');

      document.getElementById('formMessage').textContent = ''; // Clear any previous message
      document.getElementById('actionSelect').value = ''; // Optionally reset the select as well
    }


 function calculateEndDate(startId, durationId, endId, displayId) {
  const startInput = document.getElementById(startId);
  const durationInput = document.getElementById(durationId);
  const endInput = document.getElementById(endId);
  const display = document.getElementById(displayId);

  if (!startInput || !durationInput || !endInput || !display) {
    console.warn("One or more required inputs are missing.");
    return;
  }

  const startDate = startInput.value;
  const duration = parseInt(durationInput.value);

  if (startDate && duration) {
    const start = new Date(startDate);
    start.setDate(start.getDate() + duration);

    const dd = String(start.getDate()).padStart(2, '0');
    const mm = String(start.getMonth() + 1).padStart(2, '0');
    const yyyy = start.getFullYear();
    const formatted = `${dd}/${mm}/${yyyy}`;

    endInput.value = formatted;
    display.textContent = `(Ends on: ${formatted})`;
  } else {
    endInput.value = "";
    display.textContent = "(Ends on: DD/MM/YYYY)";
  }
}

    function openForm1() {
      document.getElementById('form1').style.display = 'flex';
    }

    function closeAll() {
      document.getElementById('form1').style.display = 'none';
      document.getElementById('form2').style.display = 'none';
      document.getElementById('accountForm').reset();
      document.getElementById('fullForm').reset();
      document.getElementById('formMessage').textContent = ''; // Ensure message is cleared on close
    }
    let currentEntryId = null;

    function submitForm1(event, mode) {
      event.preventDefault();

      const form1 = document.getElementById('accountForm');

       const companyInput = document.getElementById('companyName');
  companyInput.value = companyInput.value.toUpperCase();

  if (!form1.checkValidity()) {
    form1.reportValidity();
    return;
  }


      const formData = new FormData(form1);

     
      fetch('/save-entry', {
        method: 'POST',
        // body: new URLSearchParams(formData)
        body: formData
      }).then(res => res.json())
        .then(data => {
          if (data.id) {
            currentEntryId = data.id;

            const company = formData.get("name");
            // const poc = formData.get("poc");
            const mobile = formData.get("mobile");
            const city = formData.get("city");
            const email = formData.get("email");
            const type = formData.get("type");

            const form2 = document.getElementById('fullForm');
            form2.name.value = company;
            // form2.poc.value = poc;
            form2.mobile.value = mobile;
            form2.city.value = city;
            form2.email.value = email;
            form2.type.value = type;
            form2.entry_id.value = currentEntryId;

            if (mode === 'save') {
              document.getElementById('form1').style.display = 'none';
              document.getElementById('form2').style.display = 'flex';
            } else if (mode === 'save_new') {
              form1.reset();
              alert('Saved! You can add another entry now.');
            }
          } else {
            alert('Failed to save.');
          }
        });
    }

    document.getElementById('fullForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);

      
fetch('/save-entry', {
  method: 'POST',
  body: formData
}).then(res => {
  if (res.ok) {
    Swal.fire({
      icon: 'success',
      title: 'Saved!',
      text: 'Saved action successfully!',
      confirmButtonColor: '#3085d6'
    }).then((result) => {
      if (result.isConfirmed) {
        closeAll(); // Close modal (or form)
        location.reload(); // Reload after user clicks OK
      }
    });
  } else {
    Swal.fire({
      icon: 'error',
      title: 'Oops...',
      text: 'Error saving action.',
      confirmButtonColor: '#d33'
    });
  }
});

});




    // const inputs = document.querySelectorAll('.screen, .rate, .plan');

    // inputs.forEach(input => {
    //   input.addEventListener('input', () => {
    //     const type = input.dataset.type;
    //     const screens = document.querySelector(`.screen[data-type="${type}"]`).value;
    //     const rate = document.querySelector(`.rate[data-type="${type}"]`).value;
    //     const plan = document.querySelector(`.plan[data-type="${type}"]`).value;

    //     const screensVal = parseFloat(screens) || 0;
    //     const rateVal = parseFloat(rate) || 0;
    //     const planVal = parseFloat(plan) || 0;

    //     let total = 0;

    //     if (screensVal > 0 && rateVal > 0 && planVal > 0) {
    //       const totalCost = screensVal * rateVal;
    //       const costPer30Days = (totalCost / planVal) * 30;
    //       total = costPer30Days.toFixed(2);
    //     }

    //     document.getElementById(`${type}_result`).textContent = `₹${total}`;
    //   });
    // });


  function calculateAmount(sectionId) {
    const section = document.querySelector(sectionId);
    if (!section) return;

    let totalAmount = 0;

    ['r', 'c', 'o'].forEach(type => {
      const screenInput = section.querySelector(`input.screen[data-type="${type}"]`);
      const rateInput = section.querySelector(`input.rate[data-type="${type}"]`);
      const durationInput = section.querySelector('input[name$="duration"]');
      const resultSpan = section.querySelector(`#${type}_result`);

      const screens = parseFloat(screenInput?.value) || 0;
      const rate = parseFloat(rateInput?.value) || 0;
      const days = parseFloat(durationInput?.value) || 0;

      const result = screens * (rate / 30) * days;
      if (resultSpan) resultSpan.innerText = `₹${result.toFixed(2)}`;

      totalAmount += result;
    });

    const totalDisplay = section.querySelector(`#total_amount`);
    if (totalDisplay) {
      totalDisplay.innerText = `₹${totalAmount.toFixed(2)}`;
      document.getElementById("total_amount_input").value = totalAmount;
    }
  }

  // Attach events on input fields
  document.addEventListener('input', function (e) {
    if (
      e.target.matches('.screen') ||
      e.target.matches('.rate') ||
      e.target.matches('[name="duration"]') ||
      e.target.matches('[name="t_duration"]')
    ) {
      calculateAmount('#offerFields');
      calculateAmount('#taxInvoiceFields');
    }
  });

  // Trigger on page load in case values are already filled (edit mode)
  document.addEventListener("DOMContentLoaded", function () {
    calculateAmount('#offerFields');
    calculateAmount('#taxInvoiceFields');
  });

    document.querySelectorAll('.component-block').forEach(block => {
      const rows = block.querySelectorAll('.form-row');

      rows.forEach(row => {
        const inputs = row.querySelectorAll('input');
        const result = row.querySelector('.result');

        inputs.forEach(input => {
          input.addEventListener('input', () => {
            const screens = parseFloat(row.querySelector('.screen')?.value) || 0;
            const rate = parseFloat(row.querySelector('.rate')?.value) || 0;
            const plan = parseFloat(row.querySelector('.plan')?.value) || 0;

            if (screens > 0 && rate > 0 && plan > 0) {
              const totalCost = screens * rate;
              const per30DayRate = (totalCost / plan) * 30;
              result.textContent = `₹${per30DayRate.toFixed(2)}`;
            } else {
              result.textContent = `₹0`;
            }
          });
        });
      });
    });



    function formatLocalDate(dateString) {
      if (!dateString) return '';
      const date = new Date(dateString);

      // Convert to local date string
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');

      return `${year}-${month}-${day}`; // "YYYY-MM-DD"
    }




    document.addEventListener("DOMContentLoaded", () => {
      const editButtons = document.querySelectorAll(".edit-btn");

      editButtons.forEach((btn) => {
        btn.addEventListener("click", async (e) => {
          const entryId = btn.getAttribute("data-id");
          console.log("entryId", entryId);

          try {
            const response = await fetch(`/get-entry/${entryId}`);
            if (!response.ok) throw new Error("Entry not found");

            const data = await response.json();

            // Fill form2 with the fetched data
            document.querySelector('#form2 input[name="entry_id"]').value = entryId;
            document.querySelector('#form2 input[name="name"]').value = data.name || "";
            // document.querySelector('#form2 input[name="poc"]').value = data.poc_name || "";
            document.querySelector('#form2 input[name="mobile"]').value = data.mobile_number || "";
            document.querySelector('#form2 input[name="city"]').value = data.city || "";
            document.querySelector('#form2 input[name="email"]').value = data.email || "";
            document.querySelector('#form2 select[name="type"]').value = data.customer_type || "";
            document.querySelector('#form2 select[name="action"]').value = data.action_type || "";

            handleActionChange(data.action_type || "");


            document.querySelector('#form2 input[name="email_subject"]').value = data.email_sub || "";
            document.querySelector('#form2 textarea[name="email_body"]').value = data.email_body || "";
            document.querySelector('#form2 input[name="followup_email_sub"]').value = data.followup_email_sub || "";
            document.querySelector('#form2 textarea[name="followup_email_body"]').value = data.followup_email_body || "";
            document.querySelector('#form2 input[name="start_date"]').value = data.start_date || "";
            document.querySelector('#form2 input[name="end_date"]').value = data.end_date || "";
            document.querySelector('#form2 input[name="duration"]').value = data.duration || "";
            document.querySelector('#form2 input[name="residential_screen"]').value = data.residential_screen || "";
            document.querySelector('#form2 input[name="r_per_screen"]').value = data.r_per_screen || "";
            document.querySelector('#form2 select[name="r_plan"]').value = (data.r_plan || "720").trim();
            document.querySelector('#form2 input[name="corporate_screen"]').value = data.corporate_screen || "";
            document.querySelector('#form2 input[name="c_per_screen"]').value = data.c_per_screen || "";
            document.querySelector('#form2 select[name="c_plan"]').value = (data.c_plan || "720").trim();
            document.querySelector('#form2 input[name="outdoor_screen"]').value = data.outdoor_screen || "";
            document.querySelector('#form2 input[name="o_per_screen"]').value = data.o_per_screen || "";
            document.querySelector('#form2 select[name="o_plan"]').value = (data.o_plan || "720").trim();
            document.querySelector('#form2 input[name="total_offer_amount"]').value = data.total_offer_amount || "";
         document.getElementById('total_amount').innerText = `₹${data.total_offer_amount || 0}`;

            // console.log("data.r_plan:", data.r_plan);   
            // console.log("data.c_plan:", data.c_plan);
            // console.log("data.o_plan:", data.o_plan);

            document.querySelector('#form2 textarea[name="note"]').value = data.note || "";
            document.querySelector('#form2 input[name="amount"]').value = data.amount || "";
            document.querySelector('#form2 input[name="invoice_no"]').value = data.invoice_no || "";
            // document.querySelector('#form2 input[name="invoice_date"]').value = data.invoice_date || "";
            document.querySelector('#form2 input[name="po_no"]').value = data.po_no || "";
            // document.querySelector('#form2 input[name="po_date"]').value = data.po_date || ""; 
            document.querySelector('#form2 input[name="ack_no"]').value = data.ack_no || "";
            // document.querySelector('#form2 input[name="ack_date"]').value = data.ack_date || "";
            document.querySelector('input[name="invoice_date"]').value = formatLocalDate(data.invoice_date);
            document.querySelector('input[name="po_date"]').value = formatLocalDate(data.po_date);
            document.querySelector('input[name="ack_date"]').value = formatLocalDate(data.ack_date);
            // console.log("ack_date",data.ack_date || "");
            // console.log("po_date",data.po_date || "");
            // console.log("invoice_date",data.invoice_date || "");
            document.querySelector('#form2 input[name="place_of_supply"]').value = data.place_of_supply || "";
            document.querySelector('#form2 input[name="payment_terms"]').value = data.payment_terms || "";
            document.querySelector('#form2 input[name="irn"]').value = data.irn || "";
            document.querySelector('#form2 input[name="spoc"]').value = data.spoc || "";
            document.querySelector('#form2 textarea[name="billing_address"]').value = data.billing_address || "";
            document.querySelector('#form2 input[name="t_start_date"]').value = data.t_start_date || "";
            // console.log("t_start_date",data.t_start_date || "");
            document.querySelector('#form2 input[name="end_date"]').value = data.end_date || "";
            document.querySelector('#form2 input[name="t_duration"]').value = data.t_duration || "";
            document.querySelector('#form2 input[name="t_end_date"]').value = data.t_end_date || "";
            document.querySelector('#form2 input[name="t_residential_screen"]').value = data.t_residential_screen || "";
            document.querySelector('#form2 input[name="t_r_per_screen"]').value = data.t_r_per_screen || "";
            // document.querySelector('#form2 select[name="t_r_plan"]').value = data.t_r_plan || "";
            document.querySelector('#form2 select[name="t_r_plan"]').value = (data.t_r_plan || "720").trim();
            document.querySelector('#form2 input[name="t_corporate_screen"]').value = data.t_corporate_screen || "";
            document.querySelector('#form2 input[name="t_c_per_screen"]').value = data.t_c_per_screen || "";
            // document.querySelector('#form2 select[name="t_c_plan"]').value = data.t_c_plan || "";
            document.querySelector('#form2 select[name="t_c_plan"]').value = (data.t_c_plan || "720").trim();
            document.querySelector('#form2 input[name="t_outdoor_screen"]').value = data.t_outdoor_screen || "";
            document.querySelector('#form2 input[name="t_o_per_screen"]').value = data.t_o_per_screen || "";
            // document.querySelector('#form2 select[name="t_o_plan"]').value = data.t_o_plan || "";
            document.querySelector('#form2 select[name="t_o_plan"]').value = (data.t_o_plan || "720").trim();

            document.querySelector('#form2 textarea[name="t_note"]').value = data.t_note || "";
              calculateAmount('#offerFields');
      calculateAmount('#taxInvoiceFields');

      console.log(
  document.getElementById('start_date'),
  document.getElementById('duration'),
  document.getElementById('end_date'),
  document.getElementById('end_date_display')
);

      calculateEndDate('start_date', 'duration', 'end_date', 'end_date_display');
calculateEndDate('start_datee', 'durationn', 'end_datee', 'end_date_displayy');

            // Show initial file info if present
            if (data.confirmation_pdf) {
              document.getElementById("confirmation_filename").textContent = data.confirmation_pdf;
            }
            if (data.confirmation_link && data.confirmation_link_download) {
              document.getElementById("existing-confirmation-file").innerHTML = `
    <a href="${data.confirmation_link}" target="_blank">View</a> |
    <a href="${data.confirmation_link_download}" download>Download</a>
  `;
            } else {
              document.getElementById("existing-confirmation-file").innerHTML = "No file uploaded";
            }

            // Clear file input
            document.querySelector('#form2 input[name="confirmation_file"]').value = "";

            // Show the modal
            document.getElementById("form2").style.display = "flex";
          } catch (err) {
            console.error("Error fetching entry:", err);
            alert("Failed to load entry data.");
          }
        });
      });
    });



  </script>




<script>
  function applyFilters() {
    const employee = document.getElementById("employeeFilter").value.toLowerCase();
    const city = document.getElementById("cityFilter").value.toLowerCase();
    const searchInput = document.getElementById("searchInput").value.toLowerCase();

    const rows = document.querySelectorAll("tbody tr");
    let visibleCount = 0;

    rows.forEach(row => {
      const nameCell = row.children[1]?.innerText.toLowerCase();
      const cityCell = row.children[2]?.innerText.toLowerCase();
      const employeeCell = row.children[6]?.innerText.toLowerCase();

      const nameMatch = !searchInput || nameCell.includes(searchInput);
      const cityMatch = !city || cityCell.includes(city);
      const employeeMatch = !employee || employeeCell.includes(employee);

      const visible = nameMatch && cityMatch && employeeMatch;
      row.style.display = visible ? "" : "none";
      if (visible) visibleCount++;
    });

    const empText = document.getElementById("employeeFilter").options[document.getElementById("employeeFilter").selectedIndex]?.text || "";
    const cityText = document.getElementById("cityFilter").options[document.getElementById("cityFilter").selectedIndex]?.text || "";
    const opportunityText = document.getElementById("searchInput").value.trim();

    let filters = [];
    if (opportunityText) filters.push(`"${opportunityText}"`);
    if (empText && empText !== "All Employees") filters.push(empText);
    if (cityText && cityText !== "All Cities") filters.push(cityText);

    const filterStatus = filters.length ? `Filtered by ${filters.join(", ")}` : "Filtered by All Employees, All Cities";

    const timeStr = getCurrentTime();
    document.getElementById("filterStatus").innerText =
      `${visibleCount} item${visibleCount !== 1 ? "s" : ""} • Sorted by Opportunity Name • ${filterStatus} • Updated at ${timeStr}`;
  }

  function toggleDropdown(id) {
    const dropdown = document.getElementById(id);
    dropdown.style.display = "block";
  }

  function resetFilters() {
    document.getElementById("employeeFilter").value = "";
    document.getElementById("cityFilter").value = "";
    document.getElementById("searchInput").value = "";

    document.getElementById("employeeFilter").style.display = "none";
    document.getElementById("cityFilter").style.display = "none";

    const rows = document.querySelectorAll("tbody tr");
    rows.forEach(row => {
      row.style.display = "";
    });

    const timeStr = getCurrentTime();
    document.getElementById("filterStatus").innerText =
      `${rows.length} items • Sorted by Opportunity Name • Filtered by All Employees, All Cities • Updated at ${timeStr}`;
  }

  function filterTable() {
    const input = document.getElementById("searchInput");
    const searchTerm = input.value.toLowerCase();

    const table = document.querySelector(".table-container table");
    const trs = table.querySelectorAll("tbody tr");

    const employee = document.getElementById("employeeFilter").value.toLowerCase();
    const city = document.getElementById("cityFilter").value.toLowerCase();

    let visibleCount = 0;

    trs.forEach(tr => {
      const nameCell = tr.querySelectorAll("td")[1]; // Opportunity Name
      const cityCell = tr.children[2]?.innerText.toLowerCase();
      const employeeCell = tr.children[6]?.innerText.toLowerCase();

      const nameMatch = nameCell && nameCell.innerText.toLowerCase().includes(searchTerm);
      const cityMatch = !city || cityCell.includes(city);
      const employeeMatch = !employee || employeeCell.includes(employee);

      const visible = nameMatch && cityMatch && employeeMatch;
      tr.style.display = visible ? "" : "none";
      if (visible) visibleCount++;
    });

    const empText = document.getElementById("employeeFilter").options[document.getElementById("employeeFilter").selectedIndex]?.text || "";
    const cityText = document.getElementById("cityFilter").options[document.getElementById("cityFilter").selectedIndex]?.text || "";
    const opportunityText = document.getElementById("searchInput").value.trim();

    let filters = [];
    if (opportunityText) filters.push(`"${opportunityText}"`);
    if (empText && empText !== "All Employees") filters.push(empText);
    if (cityText && cityText !== "All Cities") filters.push(cityText);

    const filterStatus = filters.length ? `Filtered by ${filters.join(", ")}` : "Filtered by All Employees, All Cities";

    const timeStr = getCurrentTime();
    document.getElementById("filterStatus").innerText =
      `${visibleCount} item${visibleCount !== 1 ? "s" : ""} • Sorted by Opportunity Name • ${filterStatus} • Updated at ${timeStr}`;
  }

  function getCurrentTime() {
    const now = new Date();
    const hours = now.getHours();
    const minutes = now.getMinutes().toString().padStart(2, "0");
    const ampm = hours >= 12 ? "PM" : "AM";
    const formattedHour = hours % 12 || 12;
    return `${formattedHour}:${minutes} ${ampm}`;
  }
</script>


</body>

</html>                                                                                                                                                                                                                                                                                                                                                                                                                                                        
